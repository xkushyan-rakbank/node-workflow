# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

name: $(BuildID)_$(Date:yyyyMMdd)$(Rev:.rr)

pr:
  branches:
    include:
      - develop
    #  - releases/*
  #paths:
  # exclude:
  #  - /*.md
  #  - /**/*.md
trigger: none
#trigger:
#  - develop
#  - releases/*
jobs:
  
  - job: Webaply
    timeoutInMinutes: 120
    pool:
      name: Hosted macOS
#      demands:
#        - java
#        - JDK
    steps:
      - task: NodeTool@0
        displayName: 'Use Node 10.x'
        inputs:
          versionSpec: 10.x

      - bash : |
          cd webapply
          npm install
          npm run build
        displayName: 'Buildling webapply Application'
        enabled: true

#      - task: Npm@1
#        displayName: 'Buildling webapply Application'
#        inputs:
#          command: 'install && run build'
#          workingDir: '$(System.DefaultWorkingDirectory)/webapply'

#      - task: PublishBuildArtifacts@1
#        displayName: 'Publish Artifacts'
#        inputs:
#         PathtoPublish: '$(Build.ArtifactStagingDirectory)/'
#          PathtoPublish: '$(System.DefaultWorkingDirectory)/webapply/build'
#          ArtifactName: $(Build.BuildNumber)
#          enabled: true

      - task: PublishBuildArtifacts@1
        displayName: 'Publish Artifacts'
        inputs:
          PathtoPublish: '$(System.DefaultWorkingDirectory)/webapply/build'
          ArtifactName: 'webapply_$(Build.BuildNumber)'
# below is used for the publishing the artifacts to the jfrog artifactory 
#      - task: JFrog.jfrog-artifactory-vsts-extension.artifactory-generic-upload.ArtifactoryGenericUpload@1
#        displayName: 'Artifactory Generic Upload'
#        inputs:
#          artifactoryService: Jfrog
#          fileSpec: |
#            {
#              "files": [
#                {
#                  "pattern": "$(Build.ArtifactStagingDirectory)/webapply/build/*.zip",
#                  "target": "digital2/$(Build.BuildNumber)/CO_Webapply/"
#                }
#              ]
#            }
#          collectBuildInfo: true
         
#      - task: JFrog.jfrog-artifactory-vsts-extension.artifactory-publish-build-info.ArtifactoryPublishBuildInfo@1
#        displayName: 'Publish Build Info to Artifactory'
#        inputs:
#          artifactoryService: Jfrog